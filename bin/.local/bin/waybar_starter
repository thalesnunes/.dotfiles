#!/usr/bin/env bash

source $XDG_USER_BIN/screen_setup $1
WAYBAR_DIR="$XDG_CONFIG_HOME/waybar"

# Terminate already running bar instances
killall -q waybar

# Wait until the processes have been shut down
while pgrep -u $UID -x waybar >/dev/null; do sleep 1; done

cp $WAYBAR_DIR/default.jsonc $WAYBAR_DIR/config.jsonc

case $screen_profile in
    lh)
        echo "lh"
        primary="HDMI-A-1" ;;
    l)
        echo "l"
        primary="eDP-1" ;;
    *)
        echo "*"
        primary="eDP-1" ;;
esac
sed -i "s/\"output\": \"\\S*\",/\"output\": \"$primary\",/" $WAYBAR_DIR/config.jsonc

waybar -c $WAYBAR_DIR/config.jsonc -s $WAYBAR_DIR/style.css &!
