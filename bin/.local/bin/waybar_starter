#!/usr/bin/env bash

WAYBAR_DIR="$XDG_CONFIG_HOME/waybar"

if [ -n "$1" ]; then
    primary_monitor="$1"
else
    source $XDG_USER_BIN/screen_profile_selector
fi

# Terminate already running bar instances
killall -q waybar

# Wait until the processes have been shut down
while pgrep -u $UID -x waybar >/dev/null; do sleep 1; done

cp $WAYBAR_DIR/default.jsonc $WAYBAR_DIR/config.jsonc
sed -i "s/\"output\": \"\\S*\",/\"output\": \"$primary_monitor\",/" $WAYBAR_DIR/config.jsonc

waybar -c $WAYBAR_DIR/config.jsonc -s $WAYBAR_DIR/style.css &!
